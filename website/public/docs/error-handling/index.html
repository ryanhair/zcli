<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title">Error Handling</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <header class="site-header">
        <nav class="nav-container">
            <a href="/" class="logo">zcli</a>
            <div class="nav-links">
                <a href="/quickstart/">Quickstart</a>
                <a href="/docs/">Documentation</a>
                <a href="https://github.com/ryanhair/zcli">GitHub</a>
            </div>
        </nav>
    </header>

    <main id="main">
    <div class="docs-container">
        <aside class="docs-sidebar">
            <nav class="docs-nav">
                <div class="nav-section">
                    <h4>Getting Started</h4>
                    <ul>
                        <li><a href="/quickstart/">Quickstart</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h4>Core Concepts</h4>
                    <ul>
                        <li><a href="/docs/commands/">Commands</a></li>
                        <li><a href="/docs/options/">Arguments &amp; Options</a></li>
                        <li><a href="/docs/aliases/">Command Aliases</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h4>Advanced</h4>
                    <ul>
                        <li><a href="/docs/plugins/">Plugin System</a></li>
                        <li><a href="/docs/build-system/">Build System</a></li>
                        <li><a href="/docs/shared-modules/">Shared Modules</a></li>
                        <li><a href="/docs/c-dependencies/">C/C++ Dependencies</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h4>Reference</h4>
                    <ul>
                        <li><a href="/docs/error-handling/">Error Handling</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <article class="docs-content">
            <header class="docs-header">
                <h1>Error Handling</h1>
            </header>
            <div class="docs-body">
                <p>zcli provides comprehensive error handling through structured error types and detailed diagnostic information.</p><h2>Overview</h2><p>zcli uses <strong>structured error types</strong> where parsing functions return standard Zig error unions:</p><ul><li><strong>Success</strong>: The successfully parsed data</li><li><strong>Error</strong>: A <code>ZcliError</code> with detailed diagnostic information</li></ul><h2>Core Error Types</h2><h3>ZcliError</h3><p>The main error union used throughout zcli:</p><pre><code class="zig"><span class="keyword_modifier">pub</span> <span class="keyword">const</span> <span class="constant variable_builtin type variable">ZcliError</span> <span class="operator">=</span> <span class="keyword">error</span><span class="punctuation_bracket">{</span>
    <span class="comment_documentation comment spell">// Argument parsing errors</span>
    <span class="constant variable_builtin type variable">ArgumentMissingRequired</span><span class="punctuation_delimiter">,</span>
    <span class="constant variable_builtin type variable">ArgumentInvalidValue</span><span class="punctuation_delimiter">,</span>
    <span class="constant variable_builtin type variable">ArgumentTooMany</span><span class="punctuation_delimiter">,</span>

    <span class="comment_documentation comment spell">// Option parsing errors</span>
    <span class="constant variable_builtin type variable">OptionUnknown</span><span class="punctuation_delimiter">,</span>
    <span class="constant variable_builtin type variable">OptionMissingValue</span><span class="punctuation_delimiter">,</span>
    <span class="constant variable_builtin type variable">OptionInvalidValue</span><span class="punctuation_delimiter">,</span>
    <span class="constant variable_builtin type variable">OptionBooleanWithValue</span><span class="punctuation_delimiter">,</span>
    <span class="constant variable_builtin type variable">OptionDuplicate</span><span class="punctuation_delimiter">,</span>

    <span class="comment_documentation comment spell">// System errors</span>
    <span class="constant variable_builtin type variable">OutOfMemory</span><span class="punctuation_delimiter">,</span>

    <span class="comment_documentation comment spell">// Command routing errors</span>
    <span class="constant variable_builtin type variable">CommandNotFound</span><span class="punctuation_delimiter">,</span>
<span class="punctuation_bracket">}</span><span class="punctuation_delimiter">;</span>
</code></pre>
<h2>Automatic Error Messages</h2><p>zcli generates helpful error messages automatically:</p><pre><code class="bash"><span class="constant operator function">$</span><span class="constant function"> </span><span class="constant property function">myapp</span> <span class="constant">deploy</span> <span class="constant">prod</span> <span class="constant">--replicas</span> <span class="constant">abc</span>
<span class="constant function">Error:</span> <span class="constant">Invalid</span> <span class="constant">value</span> <span class="string constant">&apos;abc&apos;</span> <span class="constant">for</span> <span class="constant">option</span> <span class="string constant">&apos;--replicas&apos;</span>
<span class="constant function">Expected:</span> <span class="constant">unsigned</span> <span class="constant">integer</span>

<span class="constant operator function">$</span><span class="constant function"> </span><span class="constant property function">myapp</span> <span class="constant">deploi</span> <span class="constant">production</span>
<span class="constant function">Error:</span> <span class="constant">Command</span> <span class="string constant">&apos;deploi&apos;</span> <span class="constant">not</span> <span class="constant">found</span>

<span class="constant function">Did</span> <span class="constant">you</span> <span class="constant">mean?</span>
    <span class="constant function">deploy</span>

<span class="constant operator function">$</span><span class="constant function"> </span><span class="constant property function">myapp</span> <span class="constant">users</span> <span class="constant">create</span>
<span class="constant function">Error:</span> <span class="constant">Missing</span> <span class="constant">required</span> <span class="constant">argument</span> <span class="string constant">&apos;email&apos;</span>
<span class="constant function">Usage:</span> <span class="constant">myapp</span> <span class="constant">users</span> <span class="constant">create</span> <span class="operator">&lt;</span>email<span class="operator">&gt;</span> [OPTIONS]
</code></pre>
<h2>Handling Errors in Commands</h2><p>Errors from your <code>execute()</code> function propagate to pluginsâ€™ <code>onError</code> hooks:</p><pre><code class="zig"><span class="keyword_modifier">pub</span> <span class="keyword_function">fn</span> <span class="constant variable_builtin type variable function">execute</span><span class="punctuation_bracket">(</span><span class="constant variable_builtin variable_parameter variable type">args</span><span class="punctuation_delimiter">:</span> <span class="constant variable_builtin type variable">Args</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin variable_parameter variable type">options</span><span class="punctuation_delimiter">:</span> <span class="constant variable_builtin type variable">Options</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin variable_parameter variable type">context</span><span class="punctuation_delimiter">:</span> <span class="operator">*</span><span class="constant variable_builtin type variable">zcli</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">Context</span><span class="punctuation_bracket">)</span> <span class="operator">!</span><span class="type_builtin">void</span> <span class="punctuation_bracket">{</span>
    <span class="keyword">const</span> <span class="constant variable_builtin type variable">file</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">std</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">fs</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">cwd</span><span class="punctuation_bracket">(</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">openFile</span><span class="punctuation_bracket">(</span><span class="constant variable_builtin type variable">args</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">path</span><span class="punctuation_delimiter">,</span> <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span><span class="punctuation_bracket">}</span><span class="punctuation_bracket">)</span> <span class="keyword_exception">catch</span> <span class="punctuation_bracket operator">|</span><span class="constant variable_builtin type variable">err</span><span class="punctuation_bracket operator">|</span> <span class="punctuation_bracket">{</span>
        <span class="keyword_exception">try</span> <span class="constant variable_builtin type variable">context</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">stderr</span><span class="punctuation_bracket">(</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">print</span><span class="punctuation_bracket">(</span><span class="string">&quot;Failed to open {s}: {}</span><span class="string string_escape">\n</span><span class="string">&quot;</span><span class="punctuation_delimiter">,</span> <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span>
            <span class="constant variable_builtin type variable">args</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">path</span><span class="punctuation_delimiter">,</span>
            <span class="constant variable_builtin type variable">err</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_bracket">}</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
        <span class="keyword_return">return</span> <span class="constant variable_builtin type variable">err</span><span class="punctuation_delimiter">;</span>
    <span class="punctuation_bracket">}</span><span class="punctuation_delimiter">;</span>
    <span class="keyword">defer</span> <span class="constant variable_builtin type variable">file</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">close</span><span class="punctuation_bracket">(</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>

    <span class="comment_documentation comment spell">// Process file...</span>
<span class="punctuation_bracket">}</span>
</code></pre>
<h2>Plugin Error Handling</h2><p>Plugins can intercept and handle errors:</p><pre><code class="zig"><span class="keyword_modifier">pub</span> <span class="keyword_function">fn</span> <span class="constant variable_builtin type variable function">onError</span><span class="punctuation_bracket">(</span><span class="constant variable_builtin variable_parameter variable type">context</span><span class="punctuation_delimiter">:</span> <span class="operator">*</span><span class="constant variable_builtin type variable">zcli</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">Context</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin variable_parameter variable type">err</span><span class="punctuation_delimiter">:</span> <span class="type_builtin">anyerror</span><span class="punctuation_bracket">)</span> <span class="operator">!</span><span class="type_builtin">bool</span> <span class="punctuation_bracket">{</span>
    <span class="keyword_conditional">if</span> <span class="punctuation_bracket">(</span><span class="constant variable_builtin type variable">err</span> <span class="operator">==</span> <span class="keyword">error</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable">FileNotFound</span><span class="punctuation_bracket">)</span> <span class="punctuation_bracket">{</span>
        <span class="keyword_exception">try</span> <span class="constant variable_builtin type variable">context</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">stderr</span><span class="punctuation_bracket">(</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">print</span><span class="punctuation_bracket">(</span>
            <span class="string">&quot;File not found - did you mean to create it?</span><span class="string string_escape">\n</span><span class="string">&quot;</span><span class="punctuation_delimiter">,</span>
            <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span><span class="punctuation_bracket">}</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
        <span class="keyword_return">return</span> <span class="constant variable_builtin type variable">true</span><span class="punctuation_delimiter">;</span>  <span class="comment_documentation comment spell">// Error handled</span>
    <span class="punctuation_bracket">}</span>
    <span class="keyword_return">return</span> <span class="constant variable_builtin type variable">false</span><span class="punctuation_delimiter">;</span>  <span class="comment_documentation comment spell">// Let it propagate</span>
<span class="punctuation_bracket">}</span>
</code></pre>
<p>Return <code>true</code> to indicate the error was handled, <code>false</code> to let it propagate to other plugins or the default handler.</p><h2>Diagnostic Information</h2><p>When errors occur, zcli provides detailed diagnostics:</p><ul><li><strong>Field context</strong>: Which argument or option caused the error</li><li><strong>Position information</strong>: Where in the command line the error occurred</li><li><strong>Type expectations</strong>: What was expected vs. what was provided</li><li><strong>Suggestions</strong>: Smart suggestions for typos and similar names</li></ul><h2>Best Practices</h2><h3>1. Use Descriptive Error Returns</h3><pre><code class="zig"><span class="keyword_modifier">pub</span> <span class="keyword_function">fn</span> <span class="constant variable_builtin type variable function">execute</span><span class="punctuation_bracket">(</span><span class="constant variable_builtin variable_parameter variable type">args</span><span class="punctuation_delimiter">:</span> <span class="constant variable_builtin type variable">Args</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin variable_parameter variable type">options</span><span class="punctuation_delimiter">:</span> <span class="constant variable_builtin type variable">Options</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin variable_parameter variable type">context</span><span class="punctuation_delimiter">:</span> <span class="operator">*</span><span class="constant variable_builtin type variable">zcli</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">Context</span><span class="punctuation_bracket">)</span> <span class="operator">!</span><span class="type_builtin">void</span> <span class="punctuation_bracket">{</span>
    <span class="keyword">const</span> <span class="constant variable_builtin type variable">config</span> <span class="operator">=</span> <span class="constant variable_builtin function_call variable type">loadConfig</span><span class="punctuation_bracket">(</span><span class="constant variable_builtin type variable">args</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">config_path</span><span class="punctuation_bracket">)</span> <span class="keyword_exception">catch</span> <span class="punctuation_bracket operator">|</span><span class="constant variable_builtin type variable">err</span><span class="punctuation_bracket operator">|</span> <span class="punctuation_bracket">{</span>
        <span class="keyword_exception">try</span> <span class="constant variable_builtin type variable">context</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">stderr</span><span class="punctuation_bracket">(</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">print</span><span class="punctuation_bracket">(</span>
            <span class="string">&quot;Failed to load config from &apos;{s}&apos;: {}</span><span class="string string_escape">\n</span><span class="string">&quot;</span><span class="punctuation_delimiter">,</span>
            <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span> <span class="constant variable_builtin type variable">args</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">config_path</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin type variable">err</span> <span class="punctuation_bracket">}</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
        <span class="keyword_return">return</span> <span class="constant variable_builtin type variable">err</span><span class="punctuation_delimiter">;</span>
    <span class="punctuation_bracket">}</span><span class="punctuation_delimiter">;</span>
<span class="punctuation_bracket">}</span>
</code></pre>
<h3>2. Provide Context in Error Messages</h3><pre><code class="zig"><span class="keyword_conditional">if</span> <span class="punctuation_bracket">(</span><span class="constant variable_builtin type variable">value</span> <span class="operator">&gt;</span> <span class="constant variable_builtin type variable">MAX_VALUE</span><span class="punctuation_bracket">)</span> <span class="punctuation_bracket">{</span>
    <span class="keyword_exception">try</span> <span class="constant variable_builtin type variable">context</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">stderr</span><span class="punctuation_bracket">(</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">print</span><span class="punctuation_bracket">(</span>
        <span class="string">&quot;Value {d} exceeds maximum of {d}</span><span class="string string_escape">\n</span><span class="string">&quot;</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span> <span class="constant variable_builtin type variable">value</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin type variable">MAX_VALUE</span> <span class="punctuation_bracket">}</span><span class="punctuation_delimiter">,</span>
    <span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
    <span class="keyword_return">return</span> <span class="keyword">error</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable">ValueTooLarge</span><span class="punctuation_delimiter">;</span>
<span class="punctuation_bracket">}</span>
</code></pre>
<h3>3. Use the Allocator for Dynamic Messages</h3><pre><code class="zig"><span class="keyword">const</span> <span class="constant variable_builtin type variable">msg</span> <span class="operator">=</span> <span class="keyword_exception">try</span> <span class="constant variable_builtin type variable">std</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">fmt</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">allocPrint</span><span class="punctuation_bracket">(</span>
    <span class="constant variable_builtin type variable">context</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">allocator</span><span class="punctuation_delimiter">,</span>
    <span class="string">&quot;Could not find user &apos;{s}&apos; in database&quot;</span><span class="punctuation_delimiter">,</span>
    <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span><span class="constant variable_builtin type variable">args</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">username</span><span class="punctuation_bracket">}</span><span class="punctuation_delimiter">,</span>
<span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
<span class="constant variable_builtin type variable">defer</span> context<span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">allocator</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">free</span><span class="punctuation_bracket">(</span><span class="constant variable_builtin type variable">msg</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
<span class="keyword_exception">try</span> <span class="constant variable_builtin type variable">context</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">stderr</span><span class="punctuation_bracket">(</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">print</span><span class="punctuation_bracket">(</span><span class="string">&quot;{s}</span><span class="string string_escape">\n</span><span class="string">&quot;</span><span class="punctuation_delimiter">,</span> <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span><span class="constant variable_builtin type variable">msg</span><span class="punctuation_bracket">}</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
</code></pre>
<h2>Exit Codes</h2><p>zcli uses standard exit codes:</p><table><tr><th>Code</th><th>Meaning</th></tr><tr><td>0</td><td>Success</td></tr><tr><td>1</td><td>General error</td></tr><tr><td>2</td><td>Command not found</td></tr><tr><td>64</td><td>Usage error (invalid arguments)</td></tr></table><p>Commands can return custom errors that map to exit code 1 by default.</p>
            </div>
        </article>
    </div>
</main>

    <footer class="site-footer">
        <p>Built with Zig. MIT License.</p>
    </footer>
</body>
</html>
