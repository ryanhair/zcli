<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="title">Build System</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <header class="site-header">
        <nav class="nav-container">
            <a href="/" class="logo">zcli</a>
            <div class="nav-links">
                <a href="/quickstart/">Quickstart</a>
                <a href="/docs/">Documentation</a>
                <a href="https://github.com/ryanhair/zcli">GitHub</a>
            </div>
        </nav>
    </header>

    <main id="main">
    <div class="docs-container">
        <aside class="docs-sidebar">
            <nav class="docs-nav">
                <div class="nav-section">
                    <h4>Getting Started</h4>
                    <ul>
                        <li><a href="/quickstart/">Quickstart</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h4>Core Concepts</h4>
                    <ul>
                        <li><a href="/docs/commands/">Commands</a></li>
                        <li><a href="/docs/options/">Arguments &amp; Options</a></li>
                        <li><a href="/docs/aliases/">Command Aliases</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h4>Advanced</h4>
                    <ul>
                        <li><a href="/docs/plugins/">Plugin System</a></li>
                        <li><a href="/docs/build-system/">Build System</a></li>
                        <li><a href="/docs/shared-modules/">Shared Modules</a></li>
                        <li><a href="/docs/c-dependencies/">C/C++ Dependencies</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h4>Reference</h4>
                    <ul>
                        <li><a href="/docs/error-handling/">Error Handling</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <article class="docs-content">
            <header class="docs-header">
                <h1>Build System</h1>
            </header>
            <div class="docs-body">
                <p>zcli achieves zero runtime overhead by discovering commands and plugins, then generating dispatch code at build time.</p><h2>How It Works</h2><p>When you run <code>zig build</code>, zcli:</p><ol><li><strong>Command Discovery</strong> - Scans <code>src/commands/</code> recursively</li><li><strong>Plugin Integration</strong> - Loads and validates plugins</li><li><strong>Code Generation</strong> - Generates type-safe routing code</li><li><strong>Compilation</strong> - Compiles everything into a single binary</li></ol><h2>Build Process Flow</h2><pre><code>1. Command Discovery
   ├── Scan commands directory recursively
   ├── Validate command names and structure
   ├── Build command tree with metadata
   └── Handle command groups and nesting

2. Plugin Discovery &amp; Integration
   ├── Load external plugins from dependencies
   ├── Register plugin lifecycle hooks
   ├── Merge plugin commands with native commands
   └── Validate plugin compatibility

3. Registry Generation
   ├── Generate execution wrapper functions
   ├── Generate compile-time command registry
   ├── Wire plugin lifecycle hooks
   └── Output complete registry source code

4. Compilation
   ├── Compile generated registry as a module
   ├── Link command modules with zcli
   └── Produce final executable
</code></pre><h2>The generate() Function</h2><p>In your <code>build.zig</code>:</p><pre><code class="zig"><span class="keyword">const</span> <span class="module constant variable_builtin type variable">std</span> <span class="operator">=</span> <span class="function_builtin keyword_import">@import</span><span class="punctuation_bracket">(</span><span class="string">&quot;std&quot;</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>

<span class="keyword_modifier">pub</span> <span class="keyword_function">fn</span> <span class="constant variable_builtin type variable function">build</span><span class="punctuation_bracket">(</span><span class="constant variable_builtin variable_parameter variable type">b</span><span class="punctuation_delimiter">:</span> <span class="operator">*</span><span class="constant variable_builtin type variable">std</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">Build</span><span class="punctuation_bracket">)</span> <span class="type_builtin">void</span> <span class="punctuation_bracket">{</span>
    <span class="keyword">const</span> <span class="constant variable_builtin type variable">target</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">b</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">standardTargetOptions</span><span class="punctuation_bracket">(</span><span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span><span class="punctuation_bracket">}</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
    <span class="keyword">const</span> <span class="constant variable_builtin type variable">optimize</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">b</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">standardOptimizeOption</span><span class="punctuation_bracket">(</span><span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span><span class="punctuation_bracket">}</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>

    <span class="keyword">const</span> <span class="constant variable_builtin type variable">zcli_dep</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">b</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">dependency</span><span class="punctuation_bracket">(</span><span class="string">&quot;zcli&quot;</span><span class="punctuation_delimiter">,</span> <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span>
        <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">target</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">target</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">optimize</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">optimize</span><span class="punctuation_delimiter">,</span>
    <span class="punctuation_bracket">}</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
    <span class="keyword">const</span> <span class="constant variable_builtin type variable">zcli_module</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">zcli_dep</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">module</span><span class="punctuation_bracket">(</span><span class="string">&quot;zcli&quot;</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>

    <span class="keyword">const</span> <span class="constant variable_builtin type variable">exe</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">b</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">addExecutable</span><span class="punctuation_bracket">(</span><span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span>
        <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">name</span> <span class="operator">=</span> <span class="string">&quot;myapp&quot;</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">root_module</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">b</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">createModule</span><span class="punctuation_bracket">(</span><span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span>
            <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">root_source_file</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">b</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">path</span><span class="punctuation_bracket">(</span><span class="string">&quot;src/main.zig&quot;</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">,</span>
            <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">target</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">target</span><span class="punctuation_delimiter">,</span>
            <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">optimize</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">optimize</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_bracket">}</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">,</span>
    <span class="punctuation_bracket">}</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>

    <span class="constant variable_builtin type variable">exe</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">root_module</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">addImport</span><span class="punctuation_bracket">(</span><span class="string">&quot;zcli&quot;</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin type variable">zcli_module</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>

    <span class="keyword">const</span> <span class="module constant variable_builtin type variable">zcli</span> <span class="operator">=</span> <span class="function_builtin keyword_import">@import</span><span class="punctuation_bracket">(</span><span class="string">&quot;zcli&quot;</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
    <span class="keyword">const</span> <span class="constant variable_builtin type variable">cmd_registry</span> <span class="operator">=</span> <span class="constant variable_builtin type variable">zcli</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">generate</span><span class="punctuation_bracket">(</span><span class="constant variable_builtin type variable">b</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin type variable">exe</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin type variable">zcli_dep</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin type variable">zcli_module</span><span class="punctuation_delimiter">,</span> <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span>
        <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">commands_dir</span> <span class="operator">=</span> <span class="string">&quot;src/commands&quot;</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">plugins</span> <span class="operator">=</span> <span class="operator">&amp;</span><span class="punctuation_bracket">[</span><span class="constant variable_builtin type variable">_</span><span class="punctuation_bracket">]</span><span class="constant variable_builtin type variable">zcli</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">PluginConfig</span><span class="punctuation_bracket">{</span>
            <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span> <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">name</span> <span class="operator">=</span> <span class="string">&quot;zcli-help&quot;</span><span class="punctuation_delimiter">,</span> <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">path</span> <span class="operator">=</span> <span class="string">&quot;path/to/zcli-help&quot;</span> <span class="punctuation_bracket">}</span><span class="punctuation_delimiter">,</span>
            <span class="punctuation_delimiter">.</span><span class="punctuation_bracket">{</span> <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">name</span> <span class="operator">=</span> <span class="string">&quot;zcli-not-found&quot;</span><span class="punctuation_delimiter">,</span> <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">path</span> <span class="operator">=</span> <span class="string">&quot;path/to/zcli-not-found&quot;</span> <span class="punctuation_bracket">}</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_bracket">}</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">app_name</span> <span class="operator">=</span> <span class="string">&quot;myapp&quot;</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">app_version</span> <span class="operator">=</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation_delimiter">,</span>
        <span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">app_description</span> <span class="operator">=</span> <span class="string">&quot;My CLI application&quot;</span><span class="punctuation_delimiter">,</span>
    <span class="punctuation_bracket">}</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>

    <span class="constant variable_builtin type variable">exe</span><span class="punctuation_delimiter">.</span><span class="constant variable_builtin type variable_member variable">root_module</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">addImport</span><span class="punctuation_bracket">(</span><span class="string">&quot;command_registry&quot;</span><span class="punctuation_delimiter">,</span> <span class="constant variable_builtin type variable">cmd_registry</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
    <span class="constant variable_builtin type variable">b</span><span class="punctuation_delimiter">.</span><span class="type constant variable_builtin function_call variable_member variable">installArtifact</span><span class="punctuation_bracket">(</span><span class="constant variable_builtin type variable">exe</span><span class="punctuation_bracket">)</span><span class="punctuation_delimiter">;</span>
<span class="punctuation_bracket">}</span>
</code></pre>
<h2>Configuration Options</h2><p>The <code>generate()</code> function accepts:</p><table><tr><th>Field</th><th>Type</th><th>Description</th></tr><tr><td><code>commands_dir</code></td><td><code>[]const u8</code></td><td>Path to commands directory</td></tr><tr><td><code>plugins</code></td><td><code>[]PluginConfig</code></td><td>Plugin configurations</td></tr><tr><td><code>shared_modules</code></td><td><code>?[]SharedModule</code></td><td>Modules available to all commands</td></tr><tr><td><code>command_configs</code></td><td><code>?[]CommandConfig</code></td><td>Per-command configurations</td></tr><tr><td><code>app_name</code></td><td><code>[]const u8</code></td><td>Application name</td></tr><tr><td><code>app_version</code></td><td><code>[]const u8</code></td><td>Application version</td></tr><tr><td><code>app_description</code></td><td><code>[]const u8</code></td><td>Application description</td></tr></table><h2>Generated Code</h2><p>The build system generates a registry file (in <code>.zig-cache</code>) that contains:</p><ul><li>Import statements for all discovered commands</li><li>Static dispatch tables for command routing</li><li>Wired plugin lifecycle hooks</li><li>Type-safe argument/option parsing</li></ul><p>To inspect the generated code for debugging:</p><pre><code class="bash"><span class="constant function">ls</span> <span class="constant">.zig-cache/o/*/zcli_generated.zig</span>
</code></pre>
<h2>Naming Conventions</h2><ul><li><strong>File names</strong> map directly to command names</li><li><strong>Underscores</strong> become hyphens (<code>user_list.zig</code> → <code>user-list</code>)</li><li><strong>index.zig</strong> creates a command group</li><li><strong>Hidden directories</strong> (starting with <code>.</code>) are skipped</li><li><strong>Maximum nesting</strong>: 6 levels (configurable)</li></ul><h2>Troubleshooting</h2><h3>Command not showing up</h3><ol><li>Check file is in <code>commands_dir</code></li><li>Ensure file has required exports (<code>Args</code>, <code>Options</code>, <code>execute</code>)</li><li>Rebuild completely: <code>rm -rf .zig-cache zig-out &amp;&amp; zig build</code></li></ol><h3>Plugin command not working</h3><ol><li>Plugin must export <code>pub const commands = struct { ... }</code></li><li>Each command must have an <code>execute()</code> function</li><li>Check plugin path in <code>build.zig</code></li></ol><h3>Compile errors in generated code</h3><ol><li>Check <code>.zig-cache/o/*/zcli_generated.zig</code></li><li>Verify command module exports are correct</li><li>Check for type mismatches in <code>Args</code>/<code>Options</code></li></ol>
            </div>
        </article>
    </div>
</main>

    <footer class="site-footer">
        <p>Built with Zig. MIT License.</p>
    </footer>
</body>
</html>
